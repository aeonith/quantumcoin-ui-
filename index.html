<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>QuantumCoin</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <!-- Working Video Background -->
  <video autoplay muted loop playsinline id="bgVideo">
    <source src="quantum-bg.mp4" type="video/mp4" />
    Your browser does not support the video tag.
  </video>

  <div class="overlay">
    <h1>QuantumCoin</h1>
    <p>Quantum-resistant currency of the future</p>

    <div class="card">
      <h2>Buy QTC with Bitcoin</h2>
      <p>Send BTC to:</p>
      <p class="btc">bc1qv7tpdxqvgwutfrhf53nhwgp77j5lv7whnk433y</p>
      <p>Auto-send after 3 confirmations.</p>
    </div>

    <div class="card">
      <h2>Your Wallet</h2>
      <p><strong>Address:</strong> <span id="walletAddress">Loading...</span></p>
      <p><strong>Balance:</strong> <span id="walletBalance">Loading...</span> QTC</p>
      <button onclick="loadWallet()">üîÅ Refresh</button>
    </div>

    <div class="card">
      <h2>Send QTC</h2>
      <input type="text" id="sendTo" placeholder="Recipient Address" />
      <input type="number" id="sendAmount" placeholder="Amount to Send" />
      <button onclick="sendCoins()">üöÄ Send</button>
    </div>

    <div class="card">
      <h2>Register</h2>
      <input type="text" id="username" placeholder="Username" />
      <input type="password" id="password" placeholder="Password" />
      <br/>
      <label>
        <input type="checkbox" id="agree" />
        I agree to the <a href="#" id="termsLink">Terms & Conditions</a>
      </label>
      <button onclick="register()">üìù Register</button>
    </div>
  </div>

  <!-- Terms & Conditions Popup -->
  <div id="termsPopup" class="popup">
    <div class="popup-inner">
      <h3>Terms & Conditions</h3>
      <p class="fineprint">
        QuantumCoin is a decentralized quantum-resistant currency. Use at your own risk...<br/><br/>
        [Insert long-form legal details: wallet control, irreversible payments, blockchain risk, regulatory compliance, etc...]
      </p>
      <button onclick="closeTerms()">‚úîÔ∏è Close</button>
    </div>
  </div>

  <!-- Scripts MUST be at the bottom -->
  <script>
    const API = 'https://quantumcoin-ithu.onrender.com';

    async function loadWallet() {
      try {
        const res = await fetch(`${API}/wallet`);
        const data = await res.json();
        document.getElementById('walletAddress').textContent = data.address;
        document.getElementById('walletBalance').textContent = data.balance;
      } catch {
        alert('Failed to load wallet.');
      }
    }

    async function sendCoins() {
      const to = document.getElementById('sendTo').value;
      const amount = document.getElementById('sendAmount').value;
      const res = await fetch(`${API}/send`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ to, amount }),
      });
      const result = await res.json();
      alert(result.message);
      loadWallet();
    }

    async function register() {
      const user = document.getElementById('username').value;
      const pass = document.getElementById('password').value;
      const agree = document.getElementById('agree').checked;
      if (!agree) return alert("Please agree to the Terms & Conditions.");

      const res = await fetch(`${API}/register`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ user, pass }),
      });

      const result = await res.json();
      alert(result.message);
    }

    function closeTerms() {
      document.getElementById('termsPopup').style.display = 'none';
    }

    // Ensure terms button always works
    window.onload = function () {
      document.getElementById('termsLink').addEventListener('click', function (e) {
        e.preventDefault();
        document.getElementById('termsPopup').style.display = 'flex';
      });
    };
  </script>

</body>
</html>