  <!-- ▶️ RevStop & Two-Factor UI -->
  <div id="revstop-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index:2;">
    <div style="background:#222; margin:5% auto; padding:1rem; width:90%; max-width:320px; border-radius:8px; color:white;">
      <h3>RevStop™ Control</h3>
      <p>Status: <span id="revstop-status">Loading…</span></p>
      <button onclick="toggleRev(true)">Enable RevStop</button>
      <button onclick="toggleRev(false)">Disable RevStop</button>
      <button onclick="closeRev()">Close</button>
    </div>
  </div>

  <!-- 📖 Terms & Conditions Modal -->
  <div id="terms-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:3; overflow:auto;">
    <div style="background:#111; margin:5% auto; padding:1rem; width:90%; max-width:360px; border-radius:8px; color:#eee;">
      <h2>QuantumCoin™ Terms & Conditions</h2>
      <p>By creating an account or using QuantumCoin™, you agree:</p>
      <ul style="text-align:left; margin-left:1rem;">
        <li>You’re solely responsible for your private key.</li>
        <li>QuantumCoin™ is decentralized—no refunds.</li>
        <li>All transactions are final and immutable.</li>
      </ul>
      <button onclick="closeTerms()">Close</button>
    </div>
  </div>

  <!-- 🔒 Privacy Policy Modal -->
  <div id="privacy-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:3; overflow:auto;">
    <div style="background:#111; margin:5% auto; padding:1rem; width:90%; max-width:360px; border-radius:8px; color:#eee;">
      <h2>Privacy Policy</h2>
      <p>Your data (username, hashed password) is stored securely. We never sell your private key.</p>
      <button onclick="closePrivacy()">Close</button>
    </div>
  </div>

</div> <!-- /.container -->

<script>
  const API = 'https://quantumcoin-ithu.onrender.com';

  function toggleLogin(toLogin) {
    document.getElementById('register-section').style.display = toLogin ? 'none' : 'block';
    document.getElementById('login-section').style.display    = toLogin ? 'block' : 'none';
  }

  async function registerUser() {
    const user = document.getElementById('reg-username').value;
    const pass = document.getElementById('reg-password').value;
    if (!document.getElementById('agree-terms').checked) {
      return alert('You must agree to Terms & Privacy');
    }
    const res = await fetch(`${API}/register`, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({username:user,password:pass})
    });
    if (res.ok) {
      alert('Registered! Please log in.');
      toggleLogin(true);
    }
  }

  async function loginUser() {
    const user = document.getElementById('login-username').value;
    const pass = document.getElementById('login-password').value;
    const res = await fetch(`${API}/login`, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({username:user,password:pass})
    });
    if (!res.ok) {
      return alert('Login failed');
    }
    // store JWT
    const {token} = await res.json();
    localStorage.setItem('qtc_token', token);
    showWallet();
  }

  async function showWallet() {
    document.getElementById('register-section').style.display = 'none';
    document.getElementById('login-section').style.display    = 'none';
    document.getElementById('wallet-section').style.display   = 'block';

    const token = localStorage.getItem('qtc_token');
    // Fetch address
    let res = await fetch(`${API}/address`, {headers:{'Authorization':token}});
    document.getElementById('wallet-address').textContent = await res.text();

    // Fetch balance
    res = await fetch(`${API}/balance`, {headers:{'Authorization':token}});
    document.getElementById('wallet-balance').textContent = (await res.text()) + ' QTC';

    // Fetch transactions
    res = await fetch(`${API}/transactions`, {headers:{'Authorization':token}});
    const txs = await res.json();
    const ul = document.getElementById('transactions-list');
    ul.innerHTML = '';
    txs.slice(-5).reverse().forEach(t=>{
      const li = document.createElement('li');
      li.textContent = t.from==='mine' ? `Mined: +${t.amount}` : `${t.from} → ${t.to}: ${t.amount}`;
      ul.appendChild(li);
    });
  }

  async function toggleRev(enable) {
    const token = localStorage.getItem('qtc_token');
    await fetch(`${API}/revstop`, {
      method:'POST',
      headers:{'Content-Type':'application/json','Authorization':token},
      body: JSON.stringify({enable})
    });
    loadRevStatus();
  }

  async function loadRevStatus() {
    const token = localStorage.getItem('qtc_token');
    const res = await fetch(`${API}/revstop/status`, {headers:{'Authorization':token}});
    document.getElementById('revstop-status').textContent = (await res.text())==='true'?'ENABLED':'DISABLED';
  }
  function showRevStop(){
    document.getElementById('revstop-modal').style.display='block';
    loadRevStatus();
  }
  function closeRev(){ document.getElementById('revstop-modal').style.display='none'; }

  function showTerms(){ document.getElementById('terms-modal').style.display='block'; }
  function closeTerms(){ document.getElementById('terms-modal').style.display='none'; }
  function showPrivacy(){ document.getElementById('privacy-modal').style.display='block'; }
  function closePrivacy(){ document.getElementById('privacy-modal').style.display='none'; }

  function logout(){
    localStorage.removeItem('qtc_token');
    location.reload();
  }
</script>
</body>
</html>