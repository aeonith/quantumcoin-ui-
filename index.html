<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>QuantumCoinâ„¢</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body, html { height: 100%; font-family: 'Segoe UI', sans-serif; color: white; }

    /* Background video styling */
    #bg-video {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      object-fit: cover;
      z-index: -1;
    }

    .overlay {
      background: rgba(0, 0, 0, 0.6);
      padding: 2rem;
      max-width: 420px;
      margin: 4rem auto;
      border-radius: 10px;
    }

    input, button {
      width: 100%;
      margin: 0.5rem 0;
      padding: 0.6rem;
      border: none;
      border-radius: 5px;
      font-size: 1rem;
    }

    button { background: #00bfff; color: white; cursor: pointer; }

    .link { color: #00bfff; cursor: pointer; text-decoration: underline; margin-top: 1rem; display: inline-block; }

    .hidden { display: none; }

    h1 { text-align: center; margin-bottom: 1rem; }
    label { display: block; margin: 0.3rem 0; }

    ul { margin-top: 1rem; list-style: disc; padding-left: 1rem; }

    @media (max-width: 500px) {
      .overlay { margin: 1rem; padding: 1rem; }
    }

    /* Modal styling */
    .modal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.85);
      z-index: 100;
      display: none;
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background: #222;
      padding: 2rem;
      border-radius: 10px;
      max-width: 400px;
      width: 90%;
    }

    .modal-content h2 { margin-bottom: 1rem; }
  </style>
</head>
<body>

  <!-- ðŸŽ¥ Background Video -->
  <video id="bg-video" autoplay muted loop playsinline>
    <source src="quantum-bg.mp4" type="video/mp4">
  </video>

  <!-- ðŸ” Login/Register Form -->
  <div class="overlay">
    <h1>QuantumCoinâ„¢</h1>

    <div id="login-section">
      <label>Username:</label>
      <input type="text" id="login-username">
      <label>Password:</label>
      <input type="password" id="login-password">
      <button onclick="loginUser()">Login</button>
      <p class="link" onclick="toggleLogin(false)">New user? Register</p>
    </div>

    <div id="register-section" class="hidden">
      <label>Username:</label>
      <input type="text" id="reg-username">
      <label>Password:</label>
      <input type="password" id="reg-password">
      <label><input type="checkbox" id="agree-terms"> I agree to the <span class="link" onclick="showTerms()">Terms</span> and <span class="link" onclick="showPrivacy()">Privacy</span></label>
      <button onclick="registerUser()">Register</button>
      <p class="link" onclick="toggleLogin(true)">Back to Login</p>
    </div>

    <div id="wallet-section" class="hidden">
      <h2>Wallet</h2>
      <p><strong>Address:</strong> <span id="wallet-address">Loadingâ€¦</span></p>
      <p><strong>Balance:</strong> <span id="wallet-balance">--</span> QTC</p>
      <button onclick="mine()">Mine QTC</button>
      <button onclick="send()">Send QTC</button>
      <button onclick="exportBackup()">Export Backup</button>
      <button onclick="toggleRev()">Toggle RevStop</button>
      <button onclick="logout()">Logout</button>
      <h3>Last 5 Transactions</h3>
      <ul id="tx-list"></ul>
    </div>
  </div>

  <!-- ðŸ“„ Modals -->
  <div class="modal" id="terms-modal">
    <div class="modal-content">
      <h2>Terms & Conditions</h2>
      <p>You agree to all blockchain rules, wallet safety, and irreversible transactions.</p>
      <button onclick="closeTerms()">Close</button>
    </div>
  </div>

  <div class="modal" id="privacy-modal">
    <div class="modal-content">
      <h2>Privacy Policy</h2>
      <p>We never store your private key. All actions are secured end-to-end.</p>
      <button onclick="closePrivacy()">Close</button>
    </div>
  </div>

<script>
  const API = 'https://quantumcoin-ithu.onrender.com';

  function toggleLogin(isLogin) {
    document.getElementById('login-section').style.display = isLogin ? 'block' : 'none';
    document.getElementById('register-section').style.display = isLogin ? 'none' : 'block';
  }

  function showTerms()   { document.getElementById('terms-modal').style.display = 'flex'; }
  function closeTerms()  { document.getElementById('terms-modal').style.display = 'none'; }
  function showPrivacy() { document.getElementById('privacy-modal').style.display = 'flex'; }
  function closePrivacy(){ document.getElementById('privacy-modal').style.display = 'none'; }

  async function registerUser() {
    const user = document.getElementById('reg-username').value;
    const pass = document.getElementById('reg-password').value;
    const agreed = document.getElementById('agree-terms').checked;
    if (!agreed) return alert("Please accept Terms and Privacy Policy.");
    const res = await fetch(`${API}/register`, {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ username: user, password: pass })
    });
    if (res.ok) {
      alert("Registration complete. Please log in.");
      toggleLogin(true);
    } else {
      alert("Registration failed.");
    }
  }

  async function loginUser() {
    const user = document.getElementById('login-username').value;
    const pass = document.getElementById('login-password').value;
    const res = await fetch(`${API}/login`, {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ username: user, password: pass })
    });
    if (res.ok) {
      const { token } = await res.json();
      localStorage.setItem('qtc_token', token);
      loadWallet();
    } else {
      alert("Login failed.");
    }
  }

  async function loadWallet() {
    document.getElementById('login-section').style.display = 'none';
    document.getElementById('register-section').style.display = 'none';
    document.getElementById('wallet-section').style.display = 'block';

    const token = localStorage.getItem('qtc_token');

    const addrRes = await fetch(`${API}/address`, { headers: { Authorization: token } });
    document.getElementById('wallet-address').textContent = await addrRes.text();

    const balRes = await fetch(`${API}/balance`, { headers: { Authorization: token } });
    document.getElementById('wallet-balance').textContent = await balRes.text();

    const txRes = await fetch(`${API}/transactions`, { headers: { Authorization: token } });
    const txs = await txRes.json();
    const txList = document.getElementById('tx-list');
    txList.innerHTML = '';
    txs.slice(-5).reverse().forEach(t => {
      const li = document.createElement('li');
      li.textContent = `${t.from} â†’ ${t.to}: ${t.amount}`;
      txList.appendChild(li);
    });
  }

  async function mine() {
    const token = localStorage.getItem('qtc_token');
    await fetch(`${API}/mine`, { method: 'POST', headers: { Authorization: token } });
    loadWallet();
  }

  async function send() {
    const to = prompt("Recipient address:");
    const amt = prompt("Amount to send:");
    const token = localStorage.getItem('qtc_token');
    await fetch(`${API}/send`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json', Authorization: token },
      body: JSON.stringify({ to, amount: amt })
    });
    loadWallet();
  }

  async function exportBackup() {
    const token = localStorage.getItem('qtc_token');
    const res = await fetch(`${API}/export`, { headers: { Authorization: token } });
    alert("Exported Key:\n" + await res.text());
  }

  async function toggleRev() {
    const token = localStorage.getItem('qtc_token');
    await fetch(`${API}/revstop`, { method: 'POST', headers: { Authorization: token } });
    alert("RevStop toggled.");
  }

  function logout() {
    localStorage.removeItem('qtc_token');
    location.reload();
  }
</script>
</body>
</html>