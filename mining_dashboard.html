<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuantumCoin Mining Dashboard</title>
    <style>
        body {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            font-family: 'Courier New', monospace;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #00ff88;
            padding-bottom: 20px;
        }
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .status-card {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #00ff88;
            border-radius: 10px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }
        .status-card h3 {
            color: #00ff88;
            margin-top: 0;
            border-bottom: 1px solid #00ff88;
            padding-bottom: 10px;
        }
        .metric {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            padding: 5px 0;
            border-bottom: 1px dotted rgba(255, 255, 255, 0.3);
        }
        .metric-value {
            font-weight: bold;
            color: #00ff88;
        }
        .mining-progress {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        .progress-bar {
            width: 100%;
            height: 30px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff88, #00cc66);
            border-radius: 15px;
            transition: width 0.3s ease;
        }
        .log-container {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #00ff88;
            border-radius: 10px;
            padding: 20px;
            height: 300px;
            overflow-y: auto;
            font-size: 12px;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid #00ff88;
            padding-left: 10px;
        }
        .blink {
            animation: blink 1s infinite;
        }
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }
        .real-status {
            background: rgba(0, 255, 136, 0.1);
            border: 2px solid #00ff88;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            text-align: center;
        }
        .cpu-usage {
            width: 100%;
            height: 100px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            display: flex;
            align-items: end;
            padding: 10px;
            gap: 2px;
        }
        .cpu-bar {
            flex: 1;
            background: linear-gradient(to top, #ff4444, #ffff44, #44ff44);
            border-radius: 2px;
            min-height: 5px;
            transition: height 0.5s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚öõÔ∏è QuantumCoin Mining Dashboard</h1>
            <p>Real-time Bitcoin-like Cryptocurrency Mining</p>
        </div>

        <div class="real-status">
            <h2>üî• REAL MINING STATUS</h2>
            <p><strong>This is REAL computational proof-of-work mining!</strong></p>
            <p>Your CPU is computing SHA256 hashes just like Bitcoin miners</p>
        </div>

        <!-- Miner Address Input -->
        <div class="status-card" style="margin-bottom: 20px;">
            <h3>‚ö° Mining Controls</h3>
            <div style="margin-bottom: 15px;">
                <input id="miner-address" placeholder="Your QTC address" style="width: 60%; padding: 10px; margin-right: 10px; border: 1px solid #00ff88; background: rgba(0,0,0,0.3); color: white; border-radius: 5px;" />
                <button id="start-btn" style="padding: 10px 20px; margin-right: 10px; background: #00ff88; color: black; border: none; border-radius: 5px; cursor: pointer;">Start Mining</button>
                <button id="stop-btn" style="padding: 10px 20px; background: #ff4444; color: white; border: none; border-radius: 5px; cursor: pointer;">Stop</button>
            </div>
            <div id="status-line" style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 5px; min-height: 20px;"></div>
        </div>

        <div class="status-grid">
            <div class="status-card">
                <h3>üèóÔ∏è Blockchain Status</h3>
                <div class="metric">
                    <span>Block Height:</span>
                    <span class="metric-value" id="block-height">0</span>
                </div>
                <div class="metric">
                    <span>Total Supply:</span>
                    <span class="metric-value" id="total-supply">0 QTC</span>
                </div>
                <div class="metric">
                    <span>Difficulty:</span>
                    <span class="metric-value" id="difficulty">‚Äî</span>
                </div>
                <div class="metric">
                    <span>Network:</span>
                    <span class="metric-value">QuantumCoin Mainnet</span>
                </div>
            </div>

            <div class="status-card">
                <h3>‚õèÔ∏è Mining Performance</h3>
                <div class="metric">
                    <span>Hash Rate:</span>
                    <span class="metric-value blink" id="hashrate">0 H/s</span>
                </div>
                <div class="metric">
                    <span>Total Hashes:</span>
                    <span class="metric-value" id="total-hashes">0</span>
                </div>
                <div class="metric">
                    <span>Mining Time:</span>
                    <span class="metric-value" id="mining-time">0s</span>
                </div>
                <div class="metric">
                    <span>Current Nonce:</span>
                    <span class="metric-value" id="current-nonce">0</span>
                </div>
            </div>

            <div class="status-card">
                <h3>üí∞ Rewards & Economics</h3>
                <div class="metric">
                    <span>Block Reward:</span>
                    <span class="metric-value">50 QTC</span>
                </div>
                <div class="metric">
                    <span>Blocks Found:</span>
                    <span class="metric-value" id="blocks-found">0</span>
                </div>
                <div class="metric">
                    <span>Total Earned:</span>
                    <span class="metric-value" id="totalEarned">0 QTC</span>
                </div>
                <div class="metric">
                    <span>Next Halving:</span>
                    <span class="metric-value">105,120 blocks</span>
                </div>
            </div>

            <div class="status-card">
                <h3>üñ•Ô∏è System Performance</h3>
                <div class="metric">
                    <span>CPU Threads:</span>
                    <span class="metric-value" id="cpuThreads">8</span>
                </div>
                <div class="metric">
                    <span>CPU Usage:</span>
                    <span class="metric-value" id="cpuUsage">Loading...</span>
                </div>
                <div class="cpu-usage" id="cpuBars">
                    <!-- CPU bars will be generated here -->
                </div>
            </div>
        </div>

        <div class="mining-progress">
            <h3>üéØ Current Block Mining Progress</h3>
            <div id="progressText">Mining Block #1...</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <p>Target: Find hash lower than 0xffff0000000000000000000000000000000000000000000000000000</p>
        </div>

        <div class="status-card">
            <h3>üìä Live Mining Log</h3>
            <div class="log-container" id="miningLog">
                <div class="log-entry">Initializing mining dashboard...</div>
            </div>
        </div>
    </div>

    <script>
const EXPLORER_API = "http://localhost:8080";  // your explorer API status/supply
const POOL_API     = "http://localhost:3333";  // the pool we just ran

const $ = (id)=>document.getElementById(id);
const nf=(n)=>new Intl.NumberFormat().format(n);

// ---- live stats (optional, if explorer API is running) ----
async function refreshNetwork(){
  try{
    const s=await fetch(`${EXPLORER_API}/status`).then(r=>r.json()).catch(()=>({tip_height:0}));
    const sup=await fetch(`${EXPLORER_API}/supply`).then(r=>r.json()).catch(()=>({circulating:"0"}));
    let bits="‚Äî";
    try{
      const j=await fetch(`${POOL_API}/mining/getwork?address=dummy`).then(r=>r.json());
      if(!j.error && j.bits) bits=j.bits;
    }catch{}
    $('block-height').textContent = nf(s.tip_height ?? 0);
    $('total-supply').textContent = nf(Number(sup.circulating||0)) + " QTC";
    $('difficulty').textContent   = bits;
  }catch(e){}
}
setInterval(refreshNetwork,3000); refreshNetwork();

// ---- browser miner (demo) ----
let mining=false, hashes=0, startedAt=0, job=null, nonce=0, loopHandle=null, updater=null;

const hexToBytes = (hex)=>{ hex=(hex||"").replace(/^0x/,''); if(hex.length%2) hex='0'+hex;
  const arr=new Uint8Array(hex.length/2); for(let i=0;i<arr.length;i++) arr[i]=parseInt(hex.substr(i*2,2),16); return arr; };
async function sha256(b){ return await crypto.subtle.digest('SHA-256', b); }
async function sha256d(b){ return await sha256(await sha256(b)); }
function bitsToTargetBE(bits){ const e=(bits>>>24)&0xff, m=bits&0x007fffff;
  const out=new Uint8Array(32), m3=new Uint8Array([(m>>>16)&0xff,(m>>>8)&0xff,m&0xff]);
  const pos=32-(3+(e-3)); if(pos>=0&&pos<=29) out.set(m3,pos); return out; }
function leq256(a,b){ for(let i=0;i<32;i++){ if(a[i]<b[i])return true; if(a[i]>b[i])return false; } return true; }
function headerBytes(j, ts, n){
  const prev=hexToBytes(j.prev_hash), mer=hexToBytes(j.merkle_root);
  const buf=new ArrayBuffer(4+32+32+4+4+4), dv=new DataView(buf); let off=0;
  dv.setUint32(off, j.version>>>0, false); off+=4;
  new Uint8Array(buf,off,32).set(prev); off+=32;
  new Uint8Array(buf,off,32).set(mer);  off+=32;
  dv.setUint32(off, ts>>>0, false);     off+=4;
  dv.setUint32(off, j.bits>>>0, false); off+=4;
  dv.setUint32(off, n>>>0, false);      off+=4;
  return buf;
}

async function getWork(addr){
  const j=await fetch(`${POOL_API}/mining/getwork?address=${encodeURIComponent(addr)}`).then(r=>r.json());
  if(j && !j.error){ job=j; nonce=0; return true; }
  $('status-line').textContent = `‚ùå ${j.error||'getwork_failed'}`; return false;
}

async function mineLoop(addr){
  if(!mining) return;
  if(!job){ if(!(await getWork(addr))) return; }
  const shareTarget = bitsToTargetBE((job.share_bits ?? job.bits) >>> 0);
  const ts = Math.floor(Date.now()/1000);

  for(let i=0;i<2000;i++){
    const buf=headerBytes(job, ts, nonce);
    const h=new Uint8Array(await sha256d(buf));
    hashes++; if(hashes%1000===0) $('total-hashes').textContent=nf(hashes);
    $('current-nonce').textContent=nf(nonce);

    if (leq256(h, shareTarget)){
      const resp=await fetch(`${POOL_API}/mining/submit`,{
        method:'POST', headers:{'content-type':'application/json'},
        body: JSON.stringify({ job_id: job.job_id, nonce, timestamp: ts })
      }).then(r=>r.json()).catch(()=>({status:"rejected",reason:"submit_failed"}));

      if(resp.status==="accepted"){
        $('blocks-found').textContent=(Number($('blocks-found').textContent||0)+1).toString();
        $('status-line').textContent=`‚úÖ BLOCK accepted ${resp.hash}`;
      } else if (resp.status==="share"){
        $('status-line').textContent=`üü¢ share accepted`;
      } else {
        $('status-line').textContent=`‚ùå ${resp.reason||'rejected'}`;
      }
      job=null; // refresh job after any result
      break;
    }
    nonce=(nonce+1)>>>0;
  }
  loopHandle=requestAnimationFrame(()=>mineLoop(addr));
}

function startMining(){
  const addr=($('miner-address')?.value||"").trim();
  if(!addr){ $('status-line').textContent="Enter your QTC address first"; return; }
  if(mining) return;
  mining=true; hashes=0; startedAt=Date.now();
  updater=setInterval(()=>{
    const secs=((Date.now()-startedAt)/1000)|0;
    $('mining-time').textContent=`${secs}s`;
    const hr=hashes/Math.max(1,secs||1);
    $('hashrate').textContent = nf(hr.toFixed(0)) + " H/s";
  },1000);
  mineLoop(addr);
}
function stopMining(){ mining=false; if(loopHandle) cancelAnimationFrame(loopHandle); if(updater) clearInterval(updater); }

$('start-btn')?.addEventListener('click',startMining);
$('stop-btn')?.addEventListener('click',stopMining);

// ---- legacy dashboard features ----
let blocksFound = 0;

// Generate CPU bars
function initializeCPUBars() {
    const container = document.getElementById('cpuBars');
    if(container) {
        for (let i = 0; i < 8; i++) {
            const bar = document.createElement('div');
            bar.className = 'cpu-bar';
            bar.style.height = '20px';
            container.appendChild(bar);
        }
    }
}

// Simulate CPU usage animation
function updateCPUBars() {
    const bars = document.querySelectorAll('.cpu-bar');
    bars.forEach(bar => {
        const usage = mining ? (60 + Math.random() * 35) : (10 + Math.random() * 20); // 60-95% when mining, 10-30% when idle
        bar.style.height = usage + '%';
    });
}

// Add log entry
function addLogEntry(message) {
    const logContainer = document.getElementById('miningLog');
    if(logContainer) {
        const entry = document.createElement('div');
        entry.className = 'log-entry';
        entry.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
        logContainer.appendChild(entry);
        logContainer.scrollTop = logContainer.scrollHeight;

        // Keep only last 50 entries
        const entries = logContainer.querySelectorAll('.log-entry');
        if (entries.length > 50) {
            entries[0].remove();
        }
    }
}

// Initialize dashboard
function initialize() {
    initializeCPUBars();
    addLogEntry('üöÄ QuantumCoin Mining Dashboard initialized');
    addLogEntry('‚öõÔ∏è Ready to connect to mining pool');
    addLogEntry('üí° Enter your QTC address and click Start Mining');
    
    // Start updates
    setInterval(updateCPUBars, 2000); // Every 2 seconds
    
    // Update CPU usage display
    setInterval(()=>{
        const cpuUsageEl = $('cpuUsage');
        if(cpuUsageEl) {
            const usage = mining ? (60 + Math.random() * 35) : (5 + Math.random() * 15);
            cpuUsageEl.textContent = usage.toFixed(1) + '%';
        }
    }, 1000);
}

// Start when page loads
window.onload = initialize;
    </script>
</body>
</html>
